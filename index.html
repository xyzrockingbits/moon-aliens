<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–õ—É–Ω–Ω—ã–µ –ü—Ä–∏—à–µ–ª—å—Ü—ã</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #0b0d17; /* –ì–ª—É–±–æ–∫–∏–π –∫–æ—Å–º–æ—Å */
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
            touch-action: none; /* –û—Ç–∫–ª—é—á–∞–µ–º –∑—É–º –∏ —Å–∫—Ä–æ–ª–ª –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        }

        #gameCanvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }

        /* –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –º–µ–Ω—é */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            pointer-events: none; /* –ß—Ç–æ–±—ã –∫–ª–∏–∫–∏ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ —Å–∫–≤–æ–∑—å –ø—É—Å—Ç—ã–µ –º–µ—Å—Ç–∞ */
        }

        .screen {
            pointer-events: auto;
            background: rgba(11, 13, 23, 0.9);
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            border: 4px solid #4ade80;
            box-shadow: 0 0 20px #4ade80;
            max-width: 90%;
        }

        h1 {
            color: #fff;
            margin: 0 0 20px 0;
            font-size: 24px;
        }

        p {
            color: #ccc;
            font-size: 16px;
        }

        .btn {
            background: #4ade80;
            color: #000;
            border: none;
            padding: 15px 30px;
            font-size: 20px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px;
            transition: transform 0.1s;
            display: block;
            width: 200px;
            margin-left: auto;
            margin-right: auto;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-danger {
            background: #ff4d4d;
            box-shadow: 0 0 20px #ff4d4d;
            border-color: #ff4d4d;
        }
        
        #score-board {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 20px;
            font-weight: bold;
            background: rgba(0,0,0,0.5);
            padding: 5px 10px;
            border-radius: 10px;
            pointer-events: none;
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="score-board" class="hidden">–û—á–∫–∏: <span id="score-val">0</span></div>

    <div id="ui-layer">
        <!-- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ -->
        <div id="start-screen" class="screen">
            <h1>üëΩ –õ—É–Ω–Ω—ã–µ –ü—Ä–∏—à–µ–ª—å—Ü—ã üåë</h1>
            <p>–ñ–º–∏ –Ω–∞ –∏–Ω–æ–ø–ª–∞–Ω–µ—Ç—è–Ω –≤ —Ñ—É—Ç–±–æ–ª–∫–∞—Ö —Å ‚ù§Ô∏è!<br>–ù–ï –∂–º–∏ –Ω–∞ —Å–∫–µ–ª–µ—Ç–æ–≤ üíÄ!</p>
            <button class="btn" onclick="startGame()">–ò–ì–†–ê–¢–¨</button>
            <button class="btn" style="background:#a78bfa" onclick="showScreen('crossword-screen')">–ö–†–û–°–°–í–û–†–î</button>
            <button class="btn" style="background:#fcd34d" onclick="showScreen('cafe-screen')">–õ–£–ù–ù–û–ï –ö–ê–§–ï</button>
        </div>

        <!-- –ö–û–ù–ï–¶ –ò–ì–†–´ -->
        <div id="game-over-screen" class="screen hidden">
            <h1 style="color: #ff4d4d">–û–ô! üíÄ</h1>
            <p>–¢—ã –Ω–∞–∂–∞–ª –Ω–∞ –∑–ª–æ–≥–æ –ø—Ä–∏—à–µ–ª—å—Ü–∞ –∏–ª–∏ –ø—Ä–æ–ø—É—Å—Ç–∏–ª —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –¥–æ–±—Ä—ã—Ö!</p>
            <p>–°—á–µ—Ç: <span id="final-score">0</span></p>
            <button class="btn" onclick="startGame()">–ï–©–Å –†–ê–ó</button>
            <button class="btn" style="background:#ccc" onclick="showScreen('start-screen')">–ú–ï–ù–Æ</button>
        </div>

        <!-- –ö–†–û–°–°–í–û–†–î (–ó–∞–≥–ª—É—à–∫–∞) -->
        <div id="crossword-screen" class="screen hidden">
            <h1>üß© –õ—É–Ω–Ω—ã–π –ö—Ä–æ—Å—Å–≤–æ—Ä–¥</h1>
            <p>–°–ª–æ–≤–∞: –ó–ì–õ–û–†–ö, –ú–ò–ü-–ú–ò–ü, –£–§–û</p>
            <div style="background: white; color:black; padding: 10px; margin: 10px;">
                –ó –ì –õ –û –† –ö<br>
                _ _ –ò _ _ _<br>
                _ _ –ü _ –§ _<br>
                _ _ _ _ –û _
            </div>
            <button class="btn" onclick="showScreen('start-screen')">–ù–ê–ó–ê–î</button>
        </div>

        <!-- –ö–ê–§–ï (–ó–∞–≥–ª—É—à–∫–∞) -->
        <div id="cafe-screen" class="screen hidden">
            <h1>‚òï –õ—É–Ω–Ω–æ–µ –ö–∞—Ñ–µ</h1>
            <p>–ó–¥–µ—Å—å –ø–æ–¥–∞—é—Ç –ª—É–Ω–Ω—ã–π –ª–∞—Ç—Ç–µ –∏ –∫—Ä–∞—Ç–µ—Ä–Ω—ã–µ –ø–æ–Ω—á–∏–∫–∏!</p>
            <div style="font-size: 50px;">üç©üëΩ‚òï</div>
            <button class="btn" onclick="showScreen('start-screen')">–ù–ê–ó–ê–î</button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    // --- –ù–ê–°–¢–†–û–ô–ö–ò ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    let gameState = 'MENU'; // MENU, PLAYING, GAMEOVER
    let score = 0;
    let lastTime = 0;
    let aliens = [];
    let particles = [];
    
    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏
    let width, height;
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥–µ–π–º–ø–ª–µ—è
    const spawnRate = 1500; // –º—Å –º–µ–∂–¥—É –ø–æ—è–≤–ª–µ–Ω–∏–µ–º
    let nextSpawn = 0;
    const alienStayTime = 2000; // —Å–∫–æ–ª—å–∫–æ –≤–∏—Å–∏—Ç –∏–Ω–æ–ø–ª–∞–Ω–µ—Ç—è–Ω–∏–Ω

    // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
    function resize() {
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width;
        canvas.height = height;
    }
    window.addEventListener('resize', resize);
    resize();

    // --- –õ–û–ì–ò–ö–ê –ò–ì–†–´ ---

    class Alien {
        constructor() {
            this.radius = 40;
            // –ü–æ–∑–∏—Ü–∏—è: —Å–ª—É—á–∞–π–Ω–æ, –Ω–æ –Ω–µ —É –∫—Ä–∞–µ–≤
            this.x = Math.random() * (width - 100) + 50;
            this.y = Math.random() * (height - 200) + 100;
            
            // 80% –¥–æ–±—Ä—ã–µ (—Å–µ—Ä–¥–µ—á–∫–∏), 20% –∑–ª—ã–µ (—Å–∫–µ–ª–µ—Ç—ã)
            this.isBad = Math.random() < 0.2; 
            
            this.spawnTime = Date.now();
            this.scale = 0;
            this.state = 'pop-up'; // pop-up, wait, pop-down, dead
        }

        update() {
            const age = Date.now() - this.spawnTime;

            if (this.state === 'pop-up') {
                this.scale += 0.1;
                if (this.scale >= 1) {
                    this.scale = 1;
                    this.state = 'wait';
                }
            } else if (this.state === 'wait') {
                if (age > alienStayTime) {
                    this.state = 'pop-down';
                }
            } else if (this.state === 'pop-down') {
                this.scale -= 0.1;
                if (this.scale <= 0) {
                    this.state = 'dead';
                }
            }
        }

        draw() {
            if (this.state === 'dead') return;

            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.scale(this.scale, this.scale);

            // 1. –î—ã—Ä–∫–∞ (–ö—Ä–∞—Ç–µ—Ä)
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.ellipse(0, 40, 50, 20, 0, 0, Math.PI * 2);
            ctx.fill();

            // 2. –ò–Ω–æ–ø–ª–∞–Ω–µ—Ç—è–Ω–∏–Ω
            // –¢–µ–ª–æ
            ctx.fillStyle = this.isBad ? '#a8a8a8' : '#88e064'; // –°–µ—Ä—ã–π –∏–ª–∏ –∑–µ–ª–µ–Ω—ã–π
            ctx.beginPath();
            ctx.arc(0, 0, 40, 0, Math.PI * 2);
            ctx.fill();

            // –ì–ª–∞–∑–∞
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(-15, -10, 10, 0, Math.PI * 2);
            ctx.arc(15, -10, 10, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(-15, -10, 5, 0, Math.PI * 2);
            ctx.arc(15, -10, 5, 0, Math.PI * 2);
            ctx.fill();

            // –ê–Ω—Ç–µ–Ω–Ω–∞
            ctx.strokeStyle = this.isBad ? '#a8a8a8' : '#88e064';
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.moveTo(0, -40);
            ctx.lineTo(0, -60);
            ctx.stroke();
            ctx.fillStyle = 'red';
            ctx.beginPath();
            ctx.arc(0, -60, 5, 0, Math.PI * 2);
            ctx.fill();

            // –§—É—Ç–±–æ–ª–∫–∞
            ctx.font = "30px Arial";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            if (this.isBad) {
                ctx.fillText("üíÄ", 0, 20);
            } else {
                ctx.fillText("‚ù§Ô∏è", 0, 20);
            }

            ctx.restore();
        }
    }

    class Particle {
        constructor(x, y, color) {
            this.x = x;
            this.y = y;
            this.color = color;
            this.vx = (Math.random() - 0.5) * 10;
            this.vy = (Math.random() - 0.5) * 10;
            this.life = 1.0;
        }
        update() {
            this.x += this.vx;
            this.y += this.vy;
            this.life -= 0.05;
        }
        draw() {
            ctx.globalAlpha = this.life;
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, 5, 0, Math.PI*2);
            ctx.fill();
            ctx.globalAlpha = 1.0;
        }
    }

    // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï ---
    function startGame() {
        score = 0;
        document.getElementById('score-val').innerText = score;
        aliens = [];
        particles = [];
        gameState = 'PLAYING';
        
        showScreen(null); // –°–∫—Ä—ã—Ç—å –≤—Å–µ UI
        document.getElementById('score-board').classList.remove('hidden');
    }

    function gameOver() {
        gameState = 'GAMEOVER';
        document.getElementById('final-score').innerText = score;
        showScreen('game-over-screen');
    }

    function showScreen(id) {
        // –°–∫—Ä—ã—Ç—å –≤—Å–µ —ç–∫—Ä–∞–Ω—ã
        document.querySelectorAll('.screen').forEach(el => el.classList.add('hidden'));
        // –ü–æ–∫–∞–∑–∞—Ç—å –Ω—É–∂–Ω—ã–π
        if (id) {
            document.getElementById(id).classList.remove('hidden');
        }
    }

    function spawnAlien() {
        aliens.push(new Alien());
    }

    function createExplosion(x, y, color) {
        for(let i=0; i<10; i++) {
            particles.push(new Particle(x, y, color));
        }
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞/—Ç–∞–ø–∞
    canvas.addEventListener('pointerdown', (e) => {
        if (gameState !== 'PLAYING') return;

        const rect = canvas.getBoundingClientRect();
        const clickX = e.clientX - rect.left;
        const clickY = e.clientY - rect.top;

        // –ò–¥–µ–º —Å –∫–æ–Ω—Ü–∞ (—á—Ç–æ–±—ã –∫–ª–∏–∫–Ω—É—Ç—å –ø–æ –≤–µ—Ä—Ö–Ω–µ–º—É, –µ—Å–ª–∏ –æ–Ω–∏ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç—Å—è)
        for (let i = aliens.length - 1; i >= 0; i--) {
            const a = aliens[i];
            const dist = Math.sqrt((clickX - a.x)**2 + (clickY - a.y)**2);
            
            // –ó–æ–Ω–∞ –∫–ª–∏–∫–∞ –Ω–µ–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ —Å–∞–º–æ–≥–æ –ø—Ä–∏—à–µ–ª—å—Ü–∞ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
            if (dist < 60 && a.scale > 0.5 && a.state !== 'dead') {
                if (a.isBad) {
                    // –ö–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ —Å–∫–µ–ª–µ—Ç–∞ -> –ü—Ä–æ–∏–≥—Ä—ã—à
                    createExplosion(a.x, a.y, 'red');
                    gameOver();
                } else {
                    // –ö–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ —Å–µ—Ä–¥–µ—á–∫–æ -> –û—á–∫–∏
                    score++;
                    document.getElementById('score-val').innerText = score;
                    createExplosion(a.x, a.y, 'gold');
                    a.state = 'dead'; // –£–±–∏—Ä–∞–µ–º –µ–≥–æ
                }
                return; // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∫–ª–∏–∫ –∑–∞ —Ä–∞–∑
            }
        }
    });

    // --- –ì–õ–ê–í–ù–´–ô –¶–ò–ö–õ ---
    function loop(timestamp) {
        // –û—á–∏—Å—Ç–∫–∞
        ctx.fillStyle = '#0b0d17';
        ctx.fillRect(0, 0, width, height);

        // –†–∏—Å—É–µ–º –∑–≤–µ–∑–¥—ã (—Ñ–æ–Ω)
        ctx.fillStyle = 'white';
        for(let i=0; i<50; i++) {
            // –ü—Ä–æ—Å—Ç–æ–π —Ä–∞–Ω–¥–æ–º –∑–≤–µ–∑–¥ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–ª—É—á—à–µ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å, –Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∞ —Å–æ–π–¥–µ—Ç)
            const sx = (Math.sin(i * 1321 + timestamp/50000) * width + width) % width;
            const sy = (Math.cos(i * 543 + timestamp/50000) * height + height) % height;
            ctx.fillRect(sx, sy, 2, 2);
        }

        // –†–∏—Å—É–µ–º –õ—É–Ω–Ω—É—é –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å (–Ω–∏–∑)
        ctx.fillStyle = '#ccc';
        ctx.beginPath();
        ctx.ellipse(width/2, height + 300, width, 400, 0, 0, Math.PI*2);
        ctx.fill();

        if (gameState === 'PLAYING') {
            // –°–ø–∞–≤–Ω
            if (timestamp > nextSpawn) {
                spawnAlien();
                // –£—Å–∫–æ—Ä—è–µ–º –∏–≥—Ä—É —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
                nextSpawn = timestamp + Math.max(500, spawnRate - score * 20);
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–∏—à–µ–ª—å—Ü–µ–≤
            aliens.forEach(a => a.update());
            aliens.forEach(a => a.draw());
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã—Ö
            aliens = aliens.filter(a => a.state !== 'dead');

            // –ß–∞—Å—Ç–∏—Ü—ã
            particles.forEach(p => p.update());
            particles.forEach(p => p.draw());
            particles = particles.filter(p => p.life > 0);
        } else if (gameState === 'MENU') {
            // –ù–∞ —Ñ–æ–Ω–µ –º–µ–Ω—é –º–æ–∂–Ω–æ –ø—É—Å—Ç–∏—Ç—å –∏–Ω–æ–ø–ª–∞–Ω–µ—Ç—è–Ω–∏–Ω–∞ –Ω–∞ –º–∞—à–∏–Ω–∫–µ
            const carX = (timestamp / 5) % (width + 200) - 100;
            ctx.font = "50px Arial";
            ctx.fillText("üõ∏", carX, height - 100);
        }

        requestAnimationFrame(loop);
    }

    // –ó–∞–ø—É—Å–∫ —Ü–∏–∫–ª–∞
    requestAnimationFrame(loop);

</script>
</body>
</html>
